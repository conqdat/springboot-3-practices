![ui-logo](data:image/jpeg;base64,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)

## FSCMS - Fullstack CoE Management System (Back-end)

This is the Spring Boot-based backend of FSCMS - Fullstack CoE Management System

Deployment:
  * DEV environment (for devs):
    - Front-end: http://172.18.25.22:3000/ 
    - Back-end : http://172.18.25.22:8068/fullstack-coe/swagger-ui/
  * PROD environment (do not use if you're a dev):
    - Front-end: http://172.18.25.22:3068/
    - Back-end : http://172.18.25.22:8099/fullstack-coe/swagger-ui/

Stack used:
  *	Stack:
    -	Frontend: [React-TypeScript](https://www.typescriptlang.org/docs/handbook/react.html), [Ant Design](https://ant.design/), [react-router 5](https://reactrouter.com/en/main), [axios](https://axios-http.com/docs/intro), [charjs](https://www.chartjs.org/), [redux toolkit](https://redux-toolkit.js.org/)
    -	Backend: Spring Boot 2.5.8, Spring Security, Spring Data JPA, [Liquibase](https://www.liquibase.org/get-started/quickstart)
    -	Database: [PostgreSQL 14/15](https://www.postgresql.org/download/)
    - Testing: [Mockito](https://www.baeldung.com/mockito-series), [JUnit](https://www.baeldung.com/junit)
  *	Vital Softwares:
    * IDE:
        - [Visual Studio Code](https://code.visualstudio.com/download) + [Spring Boot extensions](https://marketplace.visualstudio.com/items?itemName=vmware.vscode-boot-dev-pack)
        - [Intellij IDEA Community Edition](https://www.jetbrains.com/idea/download/?section=windows) + plugins
        - [Eclipse IDE](https://www.eclipse.org/downloads/packages/release/2023-09/r/eclipse-ide-enterprise-java-and-web-developers) + [plugins](https://www.geeksforgeeks.org/7-best-plugins-for-spring-boot-and-java-in-eclipse/)
    * DBMS:
        - [DBeaver Community](https://dbeaver.io/)
        - PgAdmin (pre-installed if you install PostgreSQL)
    * JDK:
        - [Adoptium Temurin JDK 11](https://adoptium.net/) ([guide](https://mkyong.com/java/how-to-set-java_home-on-windows-10/) to set JAVA_HOME)
    * Others:
        - [TortoiseGit](https://tortoisegit.org/download/) or [VSCode Git](https://code.visualstudio.com/docs/sourcecontrol/overview) or GitBash (pre-installed if you install [Git](https://git-scm.com/downloads))
        - [Docker Desktop](https://www.docker.com/products/docker-desktop/)
        - [Node.js](https://nodejs.org/en/download)
        - [Maven](https://maven.apache.org/download.cgi) ([guide](https://phoenixnap.com/kb/install-maven-windows) to set MAVEN_HOME)
        - [Postman](https://www.postman.com/downloads/) (to send HTTP requests to test API)

Remote database info (must connect via SSH Tunnel):
  * Info
    - Host: 172.18.25.22
    - Port: 5432
    - User: coe_dev
    - Password: 123456
    - DB: dev-fullstack-coe-ms
  * SSH Tunnel info
    - Host/IP: 172.18.25.22
    - Port: 22
    - User: administrator
    - Password: GCSvn!@#

Login UI credentials

```json
{
    "username": "administrator",
    "password": "1231231231221qQ!"
}
```

## Installation, Build, Run

* To build and push to ECR use below steps

    ```
    mvn clean package docker:build
    mvn docker run
    mvn push
    ```

* Clone and run repo
1. Clone this repo (via https, if you know how to do SSH key way, please update this README file)
    * Via HTTPS (username & password)
        - If you clone this repo via https, Git will appear a prompt to enter your username and password like this 

        - ![gitlab-login-1](https://i.stack.imgur.com/oHsQe.png)

        - Just enter your company username and password, if it didn't work try the next access token way
    * Via HTTPS (access token)
        - Create your Gitlab access token like this, with expire date, name

        - ![gitlab-at](https://icinga.com/wp-content/uploads/2023/04/blogposttokens-e1682503272529.png)

        - Save your access token somewhere safe and then clone the repo, replace \<your-access-token> with your access token
        ```
        git clone https://oauth2:<your-access-token>@git.hv-vn.com/hvn-projects/fullstack-coe/fullstack-coe-mgmt.git
        ```
2. In your PostgreSQL database, create a new database with the name __fullstack-coe-ms__, 
then if it doesn't have a schema name __public__, go ahead and create one
3. Open the application-all.properties file, you will notice there are 4 variables you can pass to it, replace database if you wish to use different name
    ```
    #Fullstack CoE DB
    spring.datasource.url=jdbc:postgresql://${FULLSTACK_DB_HOST}:5432/fullstack-coe-ms
    spring.datasource.username=${FULLSTACK_DB_USER}
    spring.datasource.password=${FULLSTACK_DB_PASSWORD}

    #CORS
    cors.endpoints.allowed-origins=${ALLOWED_ORIGINS}

    ```

    * 1st way: If you use Intellij IDEA, follow this [guide](https://www.twilio.com/blog/set-up-env-variables-intellij-idea-java) to pass variables, for example:
    ```
    ALLOWED_ORIGINS=*;FULLSTACK_DB_HOST=localhost;FULLSTACK_DB_PASSWORD=postgres;FULLSTACK_DB_USER=postgres

    ```
    For server postgresql, currently can't connect (need SSL Tunnels), if you know how please update this README.md
    ```
    ALLOWED_ORIGINS=*;FULLSTACK_DB_HOST=172.18.25.22;FULLSTACK_DB_PASSWORD=123456;FULLSTACK_DB_USER=coe_dev

    ```
    * 2nd way: If you use VSCode (after installed Spring Boot extensions pack), in root of project create .vscode/launch.json, pass your variables to vmArgs object like this
    ```json
    {
        "configurations": [
            {
                "type": "java",
                "name": "Spring Boot-FullstackCoEApplication<fullstack-coe-mgmt>",
                "request": "launch",
                "cwd": "${workspaceFolder}",
                "mainClass": "com.hitachi.coe.fullstack.FullstackCoEApplication",
                "projectName": "fullstack-coe-mgmt",
                "vmArgs": "-DFULLSTACK_DB_HOST=localhost -DFULLSTACK_DB_USER=postgres -DFULLSTACK_DB_PASSWORD=postgres -DALLOWED_ORIGINS=*",
                "envFile": "${workspaceFolder}/.env"
            },
        ]
    }
    ```
    * 3rd way: If you use Eclipse (after install Spring Boot plugins), take a look at this [guide](https://examples.javacodegeeks.com/java-development/desktop-java/ide/eclipse/eclipse-environment-variable-setup-example/)
4. To run, in your preferred IDE, click Run and then liquibase will create tables, functions, PK, FK, add golden data (data that never change) for you
5. Access this localhost URL to ensure the app run properly, if you use different port please replace 8099 with yours

    __http://localhost:8099/fullstack-coe/swagger-ui/__

## Note about source code
* __ExcelUtils.java__
    - In line 173, the author hard-coded 0 because he/she want if you want to read a specific sheet from a excel file, you must move that sheet in the first line before all other sheets
    ```java
    XSSFSheet sheet = workbook.getSheetAt(0);
    ``` 
    - We can do like this to get XSSFSheet by sheet name in config json but we have to change json configKey in source-code which is time consuming and inefficient
    ```java
    XSSFSheet sheet = workbook.getSheet(excelConfigModel.getStyle().getSheetName());

    ```
    ```json
    {
        "mappingRule": {
        // Mapping rule configs
        },
        "style": {
            "sheetName": "Details",
            // other style configs
        },
        // other ConfigKey configs
    }

    ```
* __EmployeeProject.java, EmployeeUtilization.java, CoeUtilization.java__
    - In __EmployeeProject__
        + The field __utilization__ range from 0-100, it's the UT manager would negotiate about how much effort employee would focus when assign to project
        + The field __employeeType__ have 2 states (1: SHADOW, 0: OFFICE), please refer to enum __EmployeeType.java__
        + 2 fields __startDate__ & __endDate__ is the propose time range when employee would be in the project and end date
        + field __releaseDate__ after assign will be null, if __releaseDate__ == null or __releaseDate__ > current date => employee is current working on assigned project
    - In __EmployeeUtilization.java__
        + Field __billable__ come from when import UT file, its the actual UT of employee calculated by HR
    - In __CoeUtilization.java__
        + Field __duration__, its the duration between first day and last day of a given month, ex: Sep 2023 have __duration__ as follow "01 Sep 2023 - 31 Sep 2023", __startDate__: 2023-09-01 00:00:00.000, __endDate__: 2023-09-30 00:00:00.000
* __EmployeeImport.java, EmployeeImportDetail.java__
    1.  In __EmployeeImport.java__
        - Field __name__ is the filename (ex: VDC Bench - 23Nov2023.xlsx, VDC Bench - 23Nov2023.csv)
        - Field __type__ tell what type of import is it, please refer to enum __ImportOperationType__ for more info
        - Field __status__ tell is the import success or failed
        - Field __message__ of type Java Object to store error messages occur when import, I set to PostgreSQL type jsonb for more effcient storage and retrieval, preferred: __List\<ExcelErrorDetail\>__, example: 
            ```json
                [
                    {
                        "details": {
                            "PrimarySkills": "field.is.required"
                        },
                        "rowIndex": 2
                    },
                    {
                        "details": {
                            "PrimarySkills": "field.is.required"
                        },
                        "rowIndex": 3
                    }
                ]
            ```
    2.  In __EmployeeImportDetail.java__
        - Field __body__ of postgresql jsonb type is for storing each line read when import file, it can be of any type so I mark as Object
        - Field __lineNum__ is the line number when import
        - Field __messageLineList__ of postgresql jsonb type for storing import error for each line, preferred type: __List\<ErrorLineModel\>__
* __EmployeeStatus.java__
    - Have 3 states (0: Deactivated, 1: Active, 2: Probation), 0 mean that employee had leave the company therefore deactivated/removed
* __User.java__
    - Use name/password for login, 1 __Group__ have many __User__


## Possible Errors when run
* Liquibase Errors
    * When app run, liquibase will hash the .sql file then store on table __databasechangelog__
    * If you encounter Validation Failed error:
        - 1st fix (<span style="color:red">Only in dev environment</span>)
            1. Backup your __fullstack-coe-ms__ database (backup as custom and use .backup extension)
            2. Delete the __public__ schema, then create it again
            3. Run the back-end again to let liquibase recreate tables, functions, data and others
            4. Restore the database via your .backup file
        - 2nd fix (<span style="color:red">Only in dev environment</span>)
            1. When encounter this Validation Failed error

                ![validation-failed](https://forum.jmix.io/uploads/default/original/1X/27c1a03fed9b0c7b7a2d78786bbbded58272988b.png)
            2. Find the old hash and replace with the new hash in table __databasechangelog__
* Errors when import leave employee or other type of import excel
    * When the column contain number like 123456 if you leave it like that when Apache POI read Excel file, either 2 things would happen
        1.    It read as Double -> 123456.0
        2.    It read as String
    * If you try to format it in Excel file as Text, the above randomness will again happen
    * => The only way to fix is adding single-quote before the string/numeric value you wish to behave as String (Ex: '123456) or forcefuly format as String (which I did)
            
## Completed features

1. __Employees Management Screen__: search employee, search advance, import insert and import update employees, add and update employee
2. __Project Management Screen__: search project, import new project, add and update project, display project detail, assign and release employees in each project
3. __Employee Utilization Screen__: search employees utilization, import utilization file, pie chart for display employees utilization, display employee have utilization < 21%, List employee utilization that not appearing in import utilization file (no-import)
4. __Employee Project Details Screen__: Show confirm when assigning an employee who is working in another project, Search advanced in assign employee to project screen
5. __Team Screen__: add Team CRUD features, add/remove member
6. __Dashboard Screen__: add 2 skills charts, 4 on-bench charts

## To be added features

1. FeedBack for Employee Project
2. Enhance __ExcelUtil.java__ 
3. Rework all Utilization features both front-end & back-end (as UT file template for import is changed)
4. Rework EmployeeImport to store historical data when import, some old intern already done some prior work related to this, I already combine into a branch for backup/references but its still need extensive import testing (Survey Data import suddenly didn't work), branch: __sprint5_add_historical_track_to_import_leave_insert_update_employee__
5. Consider adding centerOfExcellenceId FK in __Employee.java__